{% extends "accounts/base.html" %}

{% block title %}{{ poste.titre }} - RH System{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Colonne principale : Détail du poste -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="border-b border-gray-200 pb-4 mb-4">
                    <h1 class="text-3xl font-bold text-gray-900">{{ poste.titre }}</h1>
                    <p class="mt-2 text-sm text-gray-600">
                        <span class="font-medium">Type de contrat :</span> {{ poste.get_type_contrat_display }}
                        <span class="mx-2 text-gray-300">|</span>
                        <span class="font-medium">Publié le :</span> {{ poste.date_publication|date:"d F Y" }} (il y a {{ poste.date_publication|timesince }})
                    </p>
                </div>

                <div class="space-y-6 text-gray-700">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800 mb-2">Description du poste</h2>
                        <div class="prose max-w-none">{{ poste.description|linebreaks }}</div>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800 mb-2">Responsabilités</h2>
                        <div class="prose max-w-none">{{ poste.responsabilites|linebreaks }}</div>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800 mb-2">Qualifications requises</h2>
                        <div class="prose max-w-none">{{ poste.qualifications|linebreaks }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Colonne latérale : Formulaire de candidature -->
        <div class="lg:col-span-1">
            <div class="bg-white p-6 rounded-lg shadow-md sticky top-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Postuler</h2>
                {% if user.is_authenticated %}
                    {% if user.profile.role == 'candidate' %}
                        <form method="post" enctype="multipart/form-data" class="space-y-4">
                            {% csrf_token %}
                            <div>
                                {{ form.cv_file.label_tag }}
                                {{ form.cv_file }}
                                {% if form.cv_file.errors %}
                                    <p class="text-red-500 text-xs mt-1">{{ form.cv_file.errors|first }}</p>
                                {% endif %}
                            </div>
                            <div>
                                {{ form.lettre_motivation.label_tag }}
                                {{ form.lettre_motivation }}
                                {% if form.lettre_motivation.errors %}
                                    <p class="text-red-500 text-xs mt-1">{{ form.lettre_motivation.errors|first }}</p>
                                {% endif %}
                            </div>
                            <button type="submit" class="w-full bg-primary text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-300">
                                Envoyer ma candidature
                            </button>
                        </form>
                    {% else %}
                        <p class="text-sm text-gray-600 bg-yellow-50 border border-yellow-200 p-4 rounded-md">Seuls les candidats peuvent postuler. Votre rôle actuel est : <strong>{{ user.profile.get_role_display }}</strong>.</p>
                    {% endif %}
                {% else %}
                    <p class="text-sm text-gray-600">Vous devez être <a href="{% url 'login' %}?next={{ request.path }}" class="text-primary hover:underline font-medium">connecté</a> en tant que candidat pour postuler.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}